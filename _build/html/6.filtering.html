
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Image Filtering &#8212; Image Processing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '6.filtering';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Summary" href="7.summary.html" />
    <link rel="prev" title="Interpolation" href="5.interpolation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Image Processing - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Image Processing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.what-is.html">What is Image Processing?</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.voxel-world-space.html">Voxel-space and World-space</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.rigid-body.html">Rigid-body Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.transforming-images.html">Transforming Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.interpolation.html">Interpolation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Image Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F6.filtering.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/6.filtering.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Image Filtering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels">Kernels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-in-spm">Smoothing in SPM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filters-in-the-frequency-domain">Filters in the Frequency Domain</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="image-filtering">
<h1>Image Filtering<a class="headerlink" href="#image-filtering" title="Link to this heading">#</a></h1>
<p>We are now going to move on from spatial transformations to talk about image filtering. We are not going to spend as mutch time on filtering because spatial transformations are both more common and are also the source of more errors compare to filtering. That being said, filtering is still frequently used and discussing it here will allow us to first approach topics such as convolution, which will come in handy later in the course.</p>
<p>We will be mainly discussing filters in their most intuitive form within the spatial domain. This means we are dealing with methods that directly change the voxel values of the image. We will introduce the idea of filters within the frequency domain a little later on, for those who would like a slightly different perspective. However, the main point is to understand how filters can be applied spatially to an image.</p>
<section id="kernels">
<h2>Kernels<a class="headerlink" href="#kernels" title="Link to this heading">#</a></h2>
<p>The key to understanding how image filtering works is to understand the concept of a <em>kernel</em>. A kernel is a small matrix used to weight the voxel values to produce new values in an image. The idea is that we slide the kernel across the image and then calculate a new value for the voxel the kernel is <em>centred</em> on, using all the voxels the kernel is covering.</p>
<p>As an example, we are going to use a Gaussian kernel, which is used in neuroimaging to <em>smooth</em> or <em>blur</em> images. Smoothing is a technique to reduce noise in an image because the Gaussian kernel performs a weighted averaging of neighbouring voxels. This means that random noise across voxels will tend to cancel-out, whereas values that are consistent across voxels will tend to remain. An example of a 3 x 3 Gaussian kernel is shown below</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{K} = 
\begin{bmatrix}
\frac{1}{16} &amp; \frac{1}{8} &amp; \frac{1}{16} \\
\frac{1}{8}  &amp; \frac{1}{4} &amp; \frac{1}{8}  \\
\frac{1}{16} &amp; \frac{1}{8} &amp; \frac{1}{16}
\end{bmatrix}.
\end{split}\]</div>
<p>The values in the kernel are derived from a Gaussian distribution (also known as the <em>normal</em> distribution), which is easier to see when visualised in 3D, as shown in <a class="reference internal" href="#gauss-kern-fig"><span class="std std-numref">Fig. 15</span></a> for a <span class="math notranslate nohighlight">\(17 \times 17\)</span>  kernel.</p>
<figure class="align-default" id="gauss-kern-fig">
<a class="reference internal image-reference" href="_images/gauss-kern.png"><img alt="_images/gauss-kern.png" src="_images/gauss-kern.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Illustration of a <span class="math notranslate nohighlight">\(17 \times 17\)</span> Gaussian kernel.</span><a class="headerlink" href="#gauss-kern-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Note that the <em>width</em> of a normal distribution is usually controlled by its <em>standard deviation</em> (represented by <span class="math notranslate nohighlight">\(\sigma\)</span>). In neuroimaging, however, it is more typical to talk about the <em>Full Width at Half Maximum</em> (FWHM) value in the context of a smoothing kernel. This value gives the number of voxels the kernel covers at half its height, as illustrated in <a class="reference internal" href="#fwhm-fig"><span class="std std-numref">Fig. 16</span></a>. Parameterising the kernel in this fashion means we can think about the coverage of the kernel more intuitively in terms of voxels. The standard deviation and FWHM are connected, as shown by the formula</p>
<div class="math notranslate nohighlight">
\[
\text{FWHM} = 2\sqrt{2\ln{2}}\sigma \approx 2.355 \sigma.
\]</div>
<p>You do not need to memorise this, but it is just useful to know that the two concepts are connected.</p>
<figure class="align-default" id="fwhm-fig">
<a class="reference internal image-reference" href="_images/kernel-sd-fwhm.png"><img alt="_images/kernel-sd-fwhm.png" src="_images/kernel-sd-fwhm.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Illustration of how the FWHM is defined in terms of a Gaussian distribution and how it relates to the standard deviation.</span><a class="headerlink" href="#fwhm-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In terms of how this kernel would be used to smooth an image, <a class="reference internal" href="#smoothing-kernel-fig"><span class="std std-numref">Fig. 17</span></a> tries to visualise the process. We can see that the kernel is placed over a patch of voxels and then the overlapping values are multiplied and summed to produce a value of 123.77. This process is more formally known as <em>convolution</em> and will be explored a little more below. The number 123.77 becomes the new value of the voxel the kernel is <em>centred on</em>, as indicated by the arrow. Continuing through the image in this manner produces the smoothed version of the image you can see on the right.</p>
<figure class="align-default" id="smoothing-kernel-fig">
<a class="reference internal image-reference" href="_images/smoothing-kernel.png"><img alt="_images/smoothing-kernel.png" src="_images/smoothing-kernel.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Illustration of how smoothing is achieved via the process of convolving a Gaussian kernel with an image.</span><a class="headerlink" href="#smoothing-kernel-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Link to this heading">#</a></h2>
<p>As mentioned above, the process of multiplying a kernel and an image to produce a new value is an example of a more general mathematical procedure called <em>convolution</em>. This is a procedure that we are going to encounter in a few places on this course, so it is worth a little bit of time discussing it now. To formalise this, the 1D convolution of a Gaussian kernel (<span class="math notranslate nohighlight">\(g\)</span>) and an image (<span class="math notranslate nohighlight">\(i\)</span>) at voxel <span class="math notranslate nohighlight">\(n\)</span> would be written as</p>
<div class="math notranslate nohighlight">
\[
(i \ast g)[n] = \sum_{m = -M}^{M} i[n-m]g[m]
\]</div>
<p>where the indices of the kernel run from <span class="math notranslate nohighlight">\(-M\)</span> to <span class="math notranslate nohighlight">\(M\)</span>. All this means is that you should work through all the voxels that overlap between the kernel and the image, calculate the product of the overlapping values and then add them together.</p>
<p>The main thing to understand in the formula above is that <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(g\)</span> could be <em>any functions</em>. Convolution is a very general process that creates a new function from two input functions. In our example, the new function is the smoothed spatial signal and the inputs are the un-smoothed spatial signal and the kernel. However, these could be anything. For example, the GIF below shows the convolution of a square function and curved-triangle function.</p>
<p><a title="Convolution_of_spiky_function_with_box.gif: Brian Amberg
derivative work: Tinos, CC BY-SA 3.0 &lt;https://creativecommons.org/licenses/by-sa/3.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Convolution_of_spiky_function_with_box2.gif"><img width="600" alt="Convolution of spiky function with box2" src="https://upload.wikimedia.org/wikipedia/commons/b/b9/Convolution_of_spiky_function_with_box2.gif?20100726101220"></a></p>
<p>The main thing to remeber is that the <em>height</em> of the result at each point is proportional to the <em>area of overlap</em>. So in this illustration, the height at each point is proportional to the yellow shaded area. As another example, the GIF below shows the convolution of two square functions, which produces a triangle thanks to the increasing and then decreasing overlap between the squares.</p>
<p><a title="Convolution_of_box_signal_with_itself.gif: Brian Amberg
derivative work: Tinos, CC BY-SA 3.0 &lt;https://creativecommons.org/licenses/by-sa/3.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Convolution_of_box_signal_with_itself2.gif"><img width="600" alt="Convolution of box signal with itself2" src="https://upload.wikimedia.org/wikipedia/commons/6/6a/Convolution_of_box_signal_with_itself2.gif?20100726101108"></a></p>
<p>Hopefully the similarities to running a kernel over an image are clear in these examples. We will see convolution coming up again when we come to analysing fMRI data, so make sure you have some sense of how it works here as it will make the more complex fMRI application easier to understand.</p>
</section>
<section id="smoothing-in-spm">
<h2>Smoothing in SPM<a class="headerlink" href="#smoothing-in-spm" title="Link to this heading">#</a></h2>
<p>We have used smoothing as our filtering example in this section because this is one of the key steps that we will use when processing fMRI images. Although there are many other potential filters, the Gaussian filter has become a mainstay of neuroimaging data analysis. In SPM this is implemented as a convolution operation. In the video below you will see how to use the SPM smoothing module to apply a Gaussian filter to an image. Click <a class="reference external" href="https://livemanchesterac.sharepoint.com/:u:/s/UOM-FBMH-MSc-NCCN/EdvGHqb2HsFKvcqIEsaPkUsBUGVT3opqIWOKgYfl7Oj3aA?e=dcyV56&amp;amp;download=1">here</a> to download the dataset for this example.</p>
<div style="max-width: 1280px"><div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"><iframe src="https://livemanchesterac.sharepoint.com/sites/UOM-FBMH-MSc-NCCN/_layouts/15/embed.aspx?UniqueId=f0c1d6dc-a9a5-49fe-a08d-ae4d1c7aee5e&embed=%7B%22hvm%22%3Atrue%2C%22ust%22%3Atrue%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create" width="1280" height="720" frameborder="0" scrolling="no" allowfullscreen title="SPM-Smoothing.mov" style="border:none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; height: 100%; max-width: 100%;"></iframe></div></div>
</section>
<section id="filters-in-the-frequency-domain">
<h2>Filters in the Frequency Domain<a class="headerlink" href="#filters-in-the-frequency-domain" title="Link to this heading">#</a></h2>
<p>Beyond conceptualising filters as spatial convolution, it is also possible to view filters within the <em>frequency</em>-domain. Here, we think about how filters affect both high-frequency and low-frequency <em>spatial</em> information. The outcome is the same as spatial filters and so this alternative perspective is mainly useful for understanding what filters are doing. As such, we have left this as an advanced topic for those who wish to know a bit more. You can read about this using the advanced drop-down section below.</p>
<div class="dropdown admonition">
<p class="admonition-title">Advanced: Filters in the Frequency Domain</p>
<h3 class="rubric" id="fourier-analysis">Fourier analysis</h3>
<p>The starting point for understanding frequency-domain filters is with Fourier analysis. Unfortunately, Fourier analysis is a difficult topic to fully appreciate without a fair amount of mathematical kowledge. However, at its core is a very simple principle. Imagine we had a cake and we wanted some way to unmix it to tell us <em>what</em> ingredients went into the cake, and <em>how much</em> of each ingredient went into the cake. Although we cannot do this with a real cake, Fourier analysis allows us perform this type of unmixing using <em>any signal</em> we want. The ingredients that go into the signal are periodic functions, such as sines and cosines. Using a <em>Fourier transform</em> of a signal, we can construct a <em>power spectrum</em> that tells us both the <em>frequencies</em> of these periodic functions, as well as their <em>strength</em>. Essentially, this tells us both the ingredients and the amount of each ingredient that make up any signal. Further more, the inverse Fourier transform allows us to go from those ingredients back to the original signal. What this mean is that we can break a signal down into its ingredients, remove any ingredients we do not want, and then build the signal back again with those bits removed.</p>
<p>To see this in action, let us start with a simple example. In <a class="reference internal" href="#fourier-simple-fig"><span class="std std-numref">Fig. 18</span></a> we have a cosine wave that cycles every 0.02 seconds (so 50 cycles per-second) on the <em>top</em>, and we have the Fourier transform of that wave on the <em>bottom</em>. As we can see, the power spectrum of this wave has a spike at 50Hz, which tells us that this signal is entirely constructed from a single periodic function with a frequency of 50Hz.</p>
<figure class="align-default" id="fourier-simple-fig">
<a class="reference internal image-reference" href="_images/fourier-cosine-simple.png"><img alt="_images/fourier-cosine-simple.png" src="_images/fourier-cosine-simple.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Illustration of the Fourier transform of a signal composed of a single 50Hz cosine wave.</span><a class="headerlink" href="#fourier-simple-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In <a class="reference internal" href="#fourier-complex-fig"><span class="std std-numref">Fig. 19</span></a> we have a more complex example of a signal composed of a cosine wave with a frequency of 50Hz and another cosine wave with a frequency of 150Hz. These waves have been weighted by 0.7 and 0.3 respectively so that there is more of the 50Hz wave in the signal than the 150Hz wave. Looking at the Fourier transform, we can see that not only has it managed to unmix both of these signals, but has also given us the correct amount of those signals. What is useful about this is that If we were to remove the 150Hz spike from the power spectrum and then use the inverse Fourier transform, we would completely remove the 150Hz wave from the original signal.</p>
<figure class="align-default" id="fourier-complex-fig">
<a class="reference internal image-reference" href="_images/fourier-cosine-complex.png"><img alt="_images/fourier-cosine-complex.png" src="_images/fourier-cosine-complex.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Illustration of the Fourier transform of a signal composed of a 50Hz cosine wave and a 150Hz cosine wave.</span><a class="headerlink" href="#fourier-complex-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<h3 class="rubric" id="frequency-domain-filtering">Frequency domain filtering</h3>
<p>So now let us see how we can use a Fourier transform to filter images in the frequency domain. In <a class="reference internal" href="#spatial-ft-fig"><span class="std std-numref">Fig. 20</span></a> we have taken a row from a single slice of a structural MR image and have plotted the voxel values. This is the <em>spatial signal</em> that we will be smoothing. If we put this through the Fourier transform we get the power spectrum shown on the <em>right</em>. We can then take a Gaussian distribution, as used previously to derive the Gaussian kernel, and also put that through a Fourier transform to get its power spectrum.</p>
<figure class="align-default" id="spatial-ft-fig">
<a class="reference internal image-reference" href="_images/spatial-signal-kernel-FT.png"><img alt="_images/spatial-signal-kernel-FT.png" src="_images/spatial-signal-kernel-FT.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Illustration of the Fourier transform applied to the 1D spatial signal taken from an MR image.</span><a class="headerlink" href="#spatial-ft-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The idea in the frequency domain is that we <em>multiply</em> the power spectrum of the signal and the power spectrum of the kernel. Hopefully you can see from the illustration in <a class="reference internal" href="#spatial-ft-fig"><span class="std std-numref">Fig. 20</span></a> that doing this will give preference to the low-frequencies and will completely remove any high-freqeuncies over a certain value. So let us see what happens when we perform thus multiplication and then convert the result back into the spatial domain. The result is given in <a class="reference internal" href="#spatial-ift-fig"><span class="std std-numref">Fig. 21</span></a></p>
<figure class="align-default" id="spatial-ift-fig">
<a class="reference internal image-reference" href="_images/spatial-signal-kernel-invFT.png"><img alt="_images/spatial-signal-kernel-invFT.png" src="_images/spatial-signal-kernel-invFT.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Illustration of multiplying the power spectrums of the spatial signal and kernel, and then converting the result back to the spatial domain using the inverse Fourier transform.</span><a class="headerlink" href="#spatial-ift-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>As we can see, we get a <em>smoothed</em> version of the spatial signal. This is <em>identical</em> to the results you would get if you convolved this signal with a Gaussian kernel. We can see that much of the detail has disappeared, as this corresponds to the <em>high-frequency</em> information in the signal. So all we are left with is <em>low-frequency</em> information, corresponding to the gross changes in signal intensity across the image. This means that the fine detail in the image will be gone, hence the image gets blurrier. Because this filter does not change the low-frequency components it is known as a <em>low-pass</em> filter (because it passes the low-frequency information). If the filter were flipped around so it passed over the high-frequency components, it would be known as a <em>high-pass</em> filter. So slightly confusingly, a low-pass filter removes high-frequency information and a high-pass filter removes low-frequency information.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "jupyter_matlab_kernel"
        },
        kernelOptions: {
            name: "jupyter_matlab_kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'jupyter_matlab_kernel'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="5.interpolation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Interpolation</p>
      </div>
    </a>
    <a class="right-next"
       href="7.summary.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Summary</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernels">Kernels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#smoothing-in-spm">Smoothing in SPM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filters-in-the-frequency-domain">Filters in the Frequency Domain</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>